

> 基础路径为 `/api/v1`，认证方式初期可省略（单用户本地），中期引入 JWT 或 Session。

------







## 前期（MVP 核心功能）



### 用户管理

| 方法   | 路径             | 功能说明                     |
| ------ | ---------------- | ---------------------------- |
| `POST` | `/auth/register` | 注册（若允许多用户）         |
| `POST` | `/auth/login`    | 登录（返回 token）           |
| `GET`  | `/user/profile`  | 获取当前用户信息             |
| `PUT`  | `/user/profile`  | 更新个人资料（如昵称、头像） |

> 🔐 所有中期+接口需带认证（如 `Authorization: Bearer <token>`）













### 音乐管理（Track）

| 方法     | 路径            | 功能说明                                                 |
| -------- | --------------- | -------------------------------------------------------- |
| `POST`   | `/track/upload` | 上传本地音频文件（multipart/form-data），返回 track 信息 |
| `GET`    | `/track`        | 获取所有音轨列表（分页可选）                             |
| `GET`    | `/track/{id}`   | 获取单个音轨详情                                         |
| `PUT`    | `/track/{id}`   | 更新音轨元信息（标题、歌手、专辑、封面等）               |
| `DELETE` | `/track/{id}`   | 删除音轨（仅删除数据库记录，不删本地文件）               |

> ⚠️ 文件存储：建议前端传文件，后端保存到本地磁盘或云存储，并记录路径/URL 到 `file_path`

------



### 歌单管理（Playlist）

| 方法     | 路径             | 功能说明                                          |
| -------- | ---------------- | ------------------------------------------------- |
| `POST`   | `/playlist`      | 创建新歌单（传 `{ name: "..." }`）                |
| `GET`    | `/playlist`      | 获取所有歌单列表（含每首歌数量）                  |
| `GET`    | `/playlist/{id}` | 获取歌单详情（含歌曲列表，按 `order_index` 排序） |
| `PUT`    | `/playlist/{id}` | 重命名歌单                                        |
| `DELETE` | `/playlist/{id}` | 删除歌单（级联删除关联关系）                      |

------



### 歌单-歌曲关联

| 方法     | 路径                              | 功能说明                                                  |
| -------- | --------------------------------- | --------------------------------------------------------- |
| `POST`   | `/playlist/{id}/tracks`           | 向歌单添加歌曲（传 `{ trackId: "...", orderIndex?: N }`） |
| `DELETE` | `/playlist/{id}/tracks/{trackId}` | 从歌单移除歌曲                                            |
| `PUT`    | `/playlist/{id}/reorder`          | 重新排序歌单内歌曲（传 `[trackId1, trackId2, ...]`）      |

------



### 播放控制（状态同步用，若需多设备同步）

> 若仅为单机 Web 应用，播放状态可完全由前端管理，**此部分可省略**。
> 若希望“切换页面不中断”且支持后台服务，则需简单状态接口：

| 方法   | 路径            | 功能说明                                             |
| ------ | --------------- | ---------------------------------------------------- |
| `GET`  | `/player/state` | 获取当前播放状态（当前 trackId、进度、音量、模式等） |
| `POST` | `/player/state` | 更新播放状态（用于跨标签页同步）                     |

> ✅ 更轻量方案：使用 `BroadcastChannel` 前端同步，无需后端

------

## 中期（增强体验）



### 封面与歌词

| 方法   | 路径                 | 功能说明                   |
| ------ | -------------------- | -------------------------- |
| `POST` | `/track/{id}/cover`  | 上传自定义封面（图片文件） |
| `POST` | `/track/{id}/lyrics` | 上传 `.lrc` 歌词文件       |
| `GET`  | `/track/{id}/lyrics` | 获取歌词文本（LRC 格式）   |

------

### 主题与设置

| 方法  | 路径             | 功能说明                         |
| ----- | ---------------- | -------------------------------- |
| `GET` | `/user/settings` | 获取用户设置（如 theme: 'dark'） |
| `PUT` | `/user/settings` | 更新设置                         |

------

## 后期（智能与扩展）

### 🧠 个性化推荐

| 方法  | 路径               | 功能说明                         |
| ----- | ------------------ | -------------------------------- |
| `GET` | `/recommend/daily` | 获取今日推荐歌单（基于播放历史） |

> 需配合 `play_history` 表 + 简单协同过滤或热度算法

------



### 视频转音频（谨慎实现）

| 方法   | 路径                       | 功能说明                                         |
| ------ | -------------------------- | ------------------------------------------------ |
| `POST` | `/convert/video-to-audio`  | 提交视频 URL，后台下载并提取音频（返回 task_id） |
| `GET`  | `/tasks/{taskId}`          | 查询转换任务状态（pending/success/fail）         |
| `GET`  | `/tasks/{taskId}/download` | 下载转换后的音频（若成功）                       |

> ⚠️ 法律风险高！务必限制为**用户自有内容**或公开无版权视频，且不提供下载链接分享

------



### 个性化设置扩展

| 方法  | 路径                | 功能说明                                   |
| ----- | ------------------- | ------------------------------------------ |
| `GET` | `/user/preferences` | 获取高级偏好（快捷键配置、默认播放模式等） |
| `PUT` | `/user/preferences` | 更新偏好                                   |

------

## 📦 附加建议

### 文件服务

- 音频流媒体：提供 `/audio/{trackId}` 接口，返回 `Content-Type: audio/mpeg`，支持 Range 请求（实现进度拖拽）
- 封面图片：提供 `/covers/{hash}.jpg` 静态服务

### 错误统一格式

```json
{
  "error": {
    "code": "TRACK_NOT_FOUND",
    "message": "音轨不存在"
    
  }
}
```

------

✅ **总结**：

- **前期聚焦**：音轨 CRUD + 歌单管理 + 播放状态（可选）
- **中期补全**：用户系统 + 封面/歌词 + 设置
- **后期探索**：推荐 + 转码（注意合规）

是否需要我为你生成某一部分的详细接口定义（含请求/响应示例）？例如 `/tracks/upload` 或歌单排序接口？