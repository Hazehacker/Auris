# 用户相关接口

## 接口1：用户登录

请求方式：POST

请求路径：`/user/user/login`

请求体示例：

```json
{
  "email": "user@example.com",
  "password": "123456"
}
```

> 说明：email为必填，password为必填

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": {
    "id": 1,
    "username": "张三",
    "avatar": "https://example.com/avatar.jpg",
    "email": "user@example.com",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

---

## 接口2：用户注册

请求方式：POST

请求路径：`/user/user/register`

请求体示例：

```json
{
  "username": "张三",
  "email": "user@example.com",
  "password": "123456"
}
```

> 说明：username为必填，email为必填，password为必填

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": {
    "id": 1,
    "username": "张三",
    "avatar": null,
    "email": "user@example.com",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

---

## 接口3：获取当前用户信息

请求方式：GET

请求路径：`/user/user/userinfo`

请求头：需要在请求头中携带JWT token

请求体示例：无

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": {
    "id": 1,
    "username": "张三",
    "avatar": "https://example.com/avatar.jpg",
    "gender": 1,
    "email": "user@example.com"
  }
}
```

> 说明：gender字段：0表示女，1表示男

---

## 接口4：退出登录

请求方式：POST

请求路径：`/user/user/logout`

请求头：需要在请求头中携带JWT token

请求体示例：无

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": null
}
```

---

## 接口5：修改用户信息

请求方式：PUT

请求路径：`/user/user/profile`

请求头：需要在请求头中携带JWT token

请求体示例：

```json
{
  "username": "李四",
  "email": "newemail@example.com",
  "avatar": "https://example.com/new-avatar.jpg",
  "gender": 0
}
```

> 说明：所有字段均为可选，只传需要修改的字段即可。username长度不能超过30个字符，email需要符合邮箱格式

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": {
    "id": 1,
    "username": "李四",
    "avatar": "https://example.com/new-avatar.jpg",
    "gender": 0,
    "email": "newemail@example.com"
  }
}
```

---

# 歌单相关接口

## 接口6：获取所有歌单列表

请求方式：GET

请求路径：`/user/playlist`

请求头：需要在请求头中携带JWT token

请求体示例：无

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": [
    {
      "id": 1,
      "name": "我的歌单",
      "sort": 1,
      "slug": "my-playlist",
      "status": true,
      "createTime": "2025-01-01T10:00:00",
      "updateTime": "2025-01-01T10:00:00",
      "userId": 1
    }
  ]
}
```

---

## 接口7：创建新歌单

请求方式：POST

请求路径：`/user/playlist`

请求头：需要在请求头中携带JWT token

请求体示例：

```json
{
  "name": "我的歌单",
  "sort": 1,
  "status": true
}
```

> 说明：name为必填，sort默认为1，status默认为true（true表示正常，false表示删除）

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": null
}
```

---

## 接口8：修改歌单信息

请求方式：PUT

请求路径：`/user/playlist`

请求头：需要在请求头中携带JWT token

请求体示例：

```json
{
  "id": 1,
  "name": "修改后的歌单名",
  "sort": 2,
  "status": true
}
```

> 说明：所有字段均为可选，只传需要修改的字段即可

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": null
}
```

---

## 接口9：删除歌单

请求方式：DELETE

请求路径：`/user/playlist/{id}`

请求头：需要在请求头中携带JWT token

请求参数：id（路径参数，歌单ID）

请求体示例：无

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": null
}
```

---

# 音乐相关接口

## 接口10：根据歌单id获取歌曲列表

请求方式：GET

请求路径：`/user/track/playlist/{id}`

请求头：需要在请求头中携带JWT token

请求参数：id（路径参数，歌单ID）

请求体示例：无

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": [
    {
      "id": 1,
      "title": "歌曲标题",
      "artist": "歌手名",
      "album": "专辑名",
      "duration": 240,
      "filePath": "https://example.com/audio.mp3",
      "coverUrl": "https://example.com/cover.jpg",
      "sourceType": "local",
      "createTime": "2025-01-01T10:00:00"
    }
  ]
}
```

---

## 接口11：向歌单添加歌曲

请求方式：POST

请求路径：`/user/track/playlist`

请求头：需要在请求头中携带JWT token

请求参数：

playlistId（歌单ID，必须）

orderIndex（排序字段，可选）

title（歌名，必须）

artist（歌手，必须）

album（专辑，可选）

coverUrl（封面url，可选）

file（音频，可选）



> ![image-20251229105800004](assets/image-20251229105800004.png)
>
> 说明：title为必填，其他字段为可选。file参数为可选，用于上传音频文件（使用multipart/form-data格式，字段名为file）

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": "https://example.com/audio.mp3"//如果有同时上传音频，就能返回音频链接
}
```

---

## 接口12：从歌单中移除歌曲

请求方式：DELETE

请求路径：`/user/track/playlist/{id}/{trackId}`

请求头：需要在请求头中携带JWT token

请求参数：
- id（路径参数，歌单ID）
- trackId（路径参数，歌曲ID）

请求体示例：无

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": null
}
```

---

## 接口13：重新排序歌单内歌曲

请求方式：PUT

请求路径：`/user/track/playlist/{id}/reorder`

请求头：需要在请求头中携带JWT token

请求参数：id（路径参数，歌单ID）

请求体示例：

```json
{
  "ids": [3, 1, 2, 4]
}
```

> 说明：ids为必填，数组中的顺序即为歌曲的新排序顺序

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": null
}
```

---

## 接口14：上传歌曲封面

请求方式：POST

请求路径：`/user/track/{id}/cover`

请求头：需要在请求头中携带JWT token

请求参数：id（路径参数，歌曲ID）

请求体示例：使用multipart/form-data格式上传文件，字段名为file

> 说明：file为必填，支持图片文件上传

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": "https://example.com/cover.jpg"
}
```

---

## 接口15：上传歌曲音频

请求方式：POST

请求路径：`/user/track/{id}/audio`

请求头：需要在请求头中携带JWT token

请求参数：id（路径参数，歌曲ID）

请求体示例：使用multipart/form-data格式上传文件，字段名为file

> 说明：file为必填，支持音频文件上传

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": "https://example.com/audio.mp3"
}
```

---

## 接口18：获取STS临时凭证

请求方式：GET

请求路径：`/user/track/upload/credentials`

请求头：需要在请求头中携带JWT token

请求体示例：无

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": {
    "accessKeyId": "STS.NUCpn1mMaJV2...",
    "accessKeySecret": "9dNbpbemy4qX...",
    "securityToken": "CAIS8AF1q6Ft5B2y...",
    "expiration": "2025-01-01T12:00:00Z",
    "region": "oss-cn-hangzhou",
    "bucket": "your-bucket-name"
  }
}
```

> 说明：此接口用于获取阿里云OSS的STS临时凭证，前端可使用这些凭证直接上传文件到OSS，避免文件通过后端服务器中转，提高上传效率和安全性

---

## 接口19：获取上传封面的临时凭证（v2版本）

请求方式：GET

请求路径：`/user/track/{id}/cover/v2`

请求头：需要在请求头中携带JWT token

请求参数：id（路径参数，歌曲ID）

请求体示例：无

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": {
    "accessKeyId": "STS.NUCpn1mMaJV2...",
    "accessKeySecret": "9dNbpbemy4qX...",
    "securityToken": "CAIS8AF1q6Ft5B2y...",
    "expiration": "2025-01-01T12:00:00Z",
    "region": "oss-cn-hangzhou",
    "bucket": "your-bucket-name"
  }
}
```

> 说明：此接口用于获取上传指定歌曲封面的STS临时凭证，前端可使用这些凭证直接上传封面图片到OSS。相比接口14，此接口不需要上传文件，只返回临时凭证，由前端直接上传到OSS

---

## 接口20：获取上传音频的临时凭证（v2版本）

请求方式：GET

请求路径：`/user/track/{id}/audio/v2`

请求头：需要在请求头中携带JWT token

请求参数：id（路径参数，歌曲ID）

请求体示例：无

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": {
    "accessKeyId": "STS.NUCpn1mMaJV2...",
    "accessKeySecret": "9dNbpbemy4qX...",
    "securityToken": "CAIS8AF1q6Ft5B2y...",
    "expiration": "2025-01-01T12:00:00Z",
    "region": "oss-cn-hangzhou",
    "bucket": "your-bucket-name"
  }
}
```

> 说明：此接口用于获取上传指定歌曲音频的STS临时凭证，前端可使用这些凭证直接上传音频文件到OSS。相比接口15，此接口不需要上传文件，只返回临时凭证，由前端直接上传到OSS

---

## 接口21：修改歌曲信息

请求方式：PUT

请求路径：`/user/track/{id}`

请求头：需要在请求头中携带JWT token

请求参数：id（路径参数，歌曲ID）

请求体示例：

```json
{
  "title": "歌曲标题",
  "artist": "歌手名",
  "album": "专辑名",
  "duration": 240,
  "filePath": "https://example.com/audio.mp3",
  "coverUrl": "https://example.com/cover.jpg",
  "sourceType": "local"
}
```

> 说明：所有字段均为可选，只传需要修改的字段即可。此接口支持部分更新，可以只更新一个或多个字段。例如，OSS直传音频成功后，可以只传`filePath`字段来更新音频地址。

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": null
}
```

---

## 接口22：获取当前用户的所有歌曲（单曲集合）

请求方式：GET

请求路径：`/user/track/all`

请求头：需要在请求头中携带JWT token

请求参数：无

请求体示例：无

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": [
    {
      "id": 1,
      "title": "歌曲标题",
      "artist": "歌手名",
      "album": "专辑名",
      "duration": 240,
      "filePath": "https://example.com/audio.mp3",
      "coverUrl": "https://example.com/cover.jpg",
      "sourceType": "local",
      "createTime": "2025-01-01T10:00:00"
    },
    {
      "id": 2,
      "title": "另一首歌曲",
      "artist": "另一个歌手",
      "album": "另一个专辑",
      "duration": 180,
      "filePath": "https://example.com/audio2.mp3",
      "coverUrl": "https://example.com/cover2.jpg",
      "sourceType": "local",
      "createTime": "2025-01-01T11:00:00"
    }
  ]
}
```

> 说明：此接口用于获取当前登录用户的所有歌曲，用于"单曲集合"功能。返回的歌曲列表已去重（同一首歌可能存在于多个歌单中），按创建时间倒序排列。

---

# 歌词相关接口

## 接口16：根据歌曲id获取歌词

请求方式：GET

请求路径：`/user/lyrics/{id}`

请求头：需要在请求头中携带JWT token

请求参数：id（路径参数，歌曲ID）

请求体示例：无

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": {
    "id": 1,
    "trackId": 1,
    "language": "zh",
    "content": "歌词内容...",
    "createTime": "2025-01-01T10:00:00"
  }
}
```

---

## 接口17：根据歌曲id添加歌词

请求方式：POST

请求路径：`/user/lyrics/{id}`

请求头：需要在请求头中携带JWT token

请求参数：id（路径参数，歌曲ID）

请求体示例：使用multipart/form-data格式上传文件，字段名为file

> 说明：file为必填，支持歌词文件上传（通常为.lrc格式）

响应体示例：

```json
{
  "code": 200,
  "msg": "",
  "data": null
}
```

---





# 通用说明

### 响应状态码
- `code: 200` 表示请求成功
- `code: 0` 表示请求失败，错误信息在`msg`字段中

### 认证说明
除登录和注册接口外，其他接口均需要在请求头中携带JWT token，格式为：
```
authorization: Bearer {token}
```


### 错误响应示例

```json
{
  "code": 0,
  "msg": "邮箱或密码错误",
  "data": null
}
```
